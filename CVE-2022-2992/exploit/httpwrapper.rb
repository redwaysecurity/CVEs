require 'net/http'
require 'net/https'
require 'openssl'
require 'uri'

module HttpWrapper
  def build_http(url,use_proxy=false,proxy_addr=nil,proxy_port=nil)
    url = URI.parse(url)
    if ((url.port == 443) or (url.to_s.match(%r{http(s).*})))
      if (use_proxy)
        http = Net::HTTP.new(url.host,url.port,proxy_addr,proxy_port)
      else
        http = Net::HTTP.new(url.host,url.port)
      end 
      http.use_ssl=true
      http.verify_mode=OpenSSL::SSL::VERIFY_NONE
      return http
    else
      if (use_proxy)
        http = Net::HTTP.new(url.host,url.port,proxy_addr,proxy_port)
      else
        http = Net::HTTP.new(url.host,url.port)
      end 
      return http
    end 
  end
end